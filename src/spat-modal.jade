spat-modal(show='{visible}')
  style(scoped, type='less').
    :scope {
      position: fixed;
      transform: translate3d(0, 0, 0);
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      display: block;
      z-index: 9999;
      //- background-color: rgba(0, 0, 0, 0.25);

      modal-content {
        position: absolute;
        display: block;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }

      @keyframes modal-left-in {
        0% { transform: translateX(-200px); opacity: 0; }
        100% { transform: translateX(0px); opacity: 1; }
      }
      @keyframes modal-left-out {
        0% { transform: translateX(0px); opacity: 1; }
        100% { transform: translateX(-200px); opacity: 0; }
      }

      @keyframes modal-right-in {
        0% { transform: translateX(200px); opacity: 0; }
        100% { transform: translateX(0px); opacity: 1; }
      }
      @keyframes modal-right-out {
        0% { transform: translateX(0px); opacity: 1; }
        100% { transform: translateX(200px); opacity: 0; }
      }

      @keyframes modal-bottom-in {
        0% { transform: translateY(200px); opacity: 0; }
        100% { transform: translateY(0px); opacity: 1; }
      }
      @keyframes modal-bottom-out {
        0% { transform: translateY(0px); opacity: 1; }
        100% { transform: translateY(200px); opacity: 0; }
      }

      @keyframes modal-scale-in {
        0% { transform: scale(1.5); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
      }
      @keyframes modal-scale-out {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(0.5); opacity: 0; }
      }
    }

  script.
    var self = this;
    
    this.open = function(page, options) {
      var elm = document.createElement('modal-content');
      self.root.appendChild(elm);
      var tag = riot.mount(elm, page, options)[0];

      self._openModal(tag);

      tag.root.onclick = function(e) {
        if (tag.opts.dismissible !== false && e.currentTarget === e.target) {
          tag.close();
        }
      };

      tag.close = function() {
        self._closeModal(tag);
      };
      tag.update();

      self.visible = true;
      self.update();

      return tag;
    };
    this.alert = function(text, title) {
      return self.open('modal-alert', {
        text: text,
        title: title,
      });
    };
    this.confirm = function(text, title) {
      return self.open('modal-confirm', {
        text: text,
        title: title,
      });
    };
    this.indicator = function() {
      return self.open('modal-indicator', {
        dismissible: false,
      });
    };
    this.actionsheet = function(options) {
      return self.open('spat-modal-actionsheet', options);
    }

    this.close = function() {
      var content = this.root.querySelector('modal-content');
      if (!content) {
        self.visible = false;
      }
      self.update();
    };

    this._openModal = function(modal) {
      var animation = modal.root.getAttribute('spat-animation') || 'scale';
      var modalElm = modal.refs.modal;

      if (animation) {
        modalElm.style.animationName = 'modal-' + animation + '-in';
        modalElm.style.animationDuration = '256ms';
        modalElm.style.animationPlayState = 'running';

        onceEvent(modalElm, 'animationend', function(e) {
          modalElm.style.animationPlayState = 'paused';
        });
      }
    };

    this._closeModal = function(modal) {
      var animation = modal.root.getAttribute('spat-animation') || 'scale';
      var modalElm = modal.refs.modal;

      if (animation) {
        modalElm.style.animationName = 'modal-' + animation + '-out';
        modalElm.style.animationDuration = '256ms';
        modalElm.style.animationPlayState = 'running';

        onceEvent(modalElm, 'animationend', function(e) {
          modal.unmount();
          self.close();
        });
      }
    };

    window.spat.modal = this;

    var onceEvent = function(elm, evtName, fn) {
      var temp = function() {
        elm.removeEventListener(evtName, temp, false);
        fn();
      };
      elm.addEventListener(evtName, temp, false);
    };

    window.spat.modal = this;

    //- riot.modal = {
    //-   open: this.open,
    //-   alert: function(text, title) {
    //-     return self.open('modal-alert', {
    //-       text: text,
    //-       title: title,
    //-     });
    //-   },
    //-   confirm: function(text, title) {
    //-     return self.open('modal-confirm', {
    //-       text: text,
    //-       title: title,
    //-     });
    //-   },
    //-   indicator: function(text, title) {
    //-     return self.open('modal-indicator');
    //-   },
    //- };


spat-modal-actionsheet(spat-animation='bottom')
  div.modal(ref='modal')
    div.spat-modal-content
      div.spat-modal-title(if='{opts.title}') {opts.title}
      div.spat-modal-button(each='{opts.buttons}', class='{style}', onclick='{select}') {label}

    div.spat-modal-footer
      div.spat-modal-button(onclick='{close}') Cancel
  style(scoped, type='less').
    :scope {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      background-color: rgba(0, 0, 0, 0.1);
      .modal {
        margin: 16px;
        width: 100%;
        max-width: 640px;
        .spat-modal-content {
          margin-bottom: 12px;
          border-radius: 8px;
          overflow: hidden;
          .spat-modal-title {
            background-color: rgba(255, 255, 255, 0.95);
            text-align: center;
            padding: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: #666;
            font-size: 14px;
          }
          .spat-modal-button {
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.95);
            text-align: center;
            padding: 12px;
            color: blue;
            cursor: pointer;
            &:not(:last-child) {
              border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            }

            &.danger {
              color: red;
            }
            &.disable {
              color: rgba(180, 180, 180, 1);
            }
          }
        }

        .spat-modal-footer {
          border-radius: 8px;
          overflow: hidden;

          .spat-modal-button {
            cursor: pointer;
            color: blue;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.95);
            text-align: center;
            padding: 12px;
          }
        }
      }
    }

  script.
    var self = this;
    this.select = function(e) {
      self.trigger('select', e);
      self.close();
    };
